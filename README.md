# Тестовое Roistat
Так как одним из основных условий является отсутствие использования полноценного фреймворка, но при этом нужно соблюсти 
основные принципы разработки, я воспользовался некоторыми компонентами symfony.

## Запуск
Установить зависимости
```bash
composer install
```

Запустить можно как угодно, указать серверу папку public. Пример со встроенным веб-сервером php
```bash
cd public
php -S localhost
```

Также для авторизации интеграции в amocrm нужно открыть доступ к приложению через интернет. В случае с локалкой можно 
использовать ngrok
```bash
ngrok http 80
```

## API AmoCRM
В аккаунте amocrm нужно создать приватную интеграцию без фронта. В настройках указать путь к `/oauth/callback`
В корне проекта создать файл `.env` с настройками интеграции
```dotenv
AMOCRM_CLIENT_ID = ID интеграции
AMOCRM_CLIENT_SECRET = Секретный ключ
AMOCRM_REDIRECT_URI = Ссылка на /oauth/callback
```

После этого при первом запуске перейдите по адресу `/oauth/redirect` и предоставьте интеграции доступ к аккаунту.
В итоге, если все настроено верно вы увидите сообщение `Access token received`. В папке `storage` проекта должен 
появиться файл `amocrm_token.json`. Интеграция готова к использованию.

## Использование
На главной странице находится форма из четырех полей. При отправке формы в AmoCRM будет добавлена сделка с контактом.
Здесь нет хитрого контроля за дублями контактов, но с одним и тем же номером, или email-ом дубль не создастся, сделка
будет прикреплена с существующему контакту. Уведомления об ошибках или успешной отправке формы появляются сверху.

## Реализация
Опишу краткие моменты по реализации.

### Фронтенд
Для фронта предлагалось использование фреймворка с которым есть опыт. У меня есть опыт работы с Vue.js, но не увидел
смысла использовать его для такой формы, поэтому реализовал на ванильном JS и не стал добавлять в проект вебпак и прочее.

### Бэкенд
На бэкенде недостаточно хороша проработана работа с ошибками, хотя довести ее до ума не так долго. Для валидации можно
было бы подключить отдельный пакет, но так как все что нам нужно провалидировать - 4 поля, а валидация итак есть в DTO, 
решил что этого достаточно для тестового. 

Для обработки ошибок и JSON-запросов реализовал два Listener-а событий HTTP ядра. Для работы с файлом токена - класс `AccessToken`, 
преобразующий JSON в объект токена и обратно.

OAuth реализована в `OAuthController`. Работа с формой в `FormController`. Маршруты находятся в `config/routes.yaml`.
Излишне, но подключил `twig/twig`, можно было бы обойтись без него. Для работы с путями добавил хелперы в `src/helpers.php`.
Точка входа в приложение, как обычно, `public/index.php`.
